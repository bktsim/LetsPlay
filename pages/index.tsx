/* eslint-disable react/jsx-key */
import { Spacer } from "@nextui-org/react";
import type { NextPage } from "next";
import Head from "next/head";
import styles from "../styles/Home.module.css";
import CustomNavbar from "./src/components/CustomNavbar";
import EventCard from "./src/components/EventCard";
import EventCarousel from "./src/components/EventCarousel";
import ProfileCard from "./src/components/ProfileCard";
import ProfileCarousel from "./src/components/ProfileCarousel";
import InterestCarousel from "./src/components/InterestCarousel";
import { LoginContext } from "./_app";
import { event, eventOnline, profile } from "./constants/fakeData";
import { useContext } from "react";
import { Interest, User } from "../controller/models/user";
import { Event } from "../controller/models/events";

const a = <EventCard info={event} />;
const b = <EventCard info={eventOnline} />;
const c = <ProfileCard info={profile} />;

export async function getServerSideProps() {
  const allUsers = await fetch("http://localhost:3000/api/user", {
    method: "GET",
    headers: {
      "Content-type": "application/json; charset=UTF-8",
    },
  }).then((res) => {
    if (res.status === 200) {
      return res.json().then((json) => json.users);
    } else {
      return [];
    }
  });
  const allInterests = await fetch("http://localhost:3000/api/interest", {
    method: "GET",
    headers: {
      "Content-type": "application/json; charset=UTF-8",
    },
  }).then((res) => {
    if (res.status === 200) {
      return res.json().then((json) => json.interests);
    } else {
      return [];
    }
  });

  const allEvents = await fetch("http://localhost:3000/api/event", {
    method: "GET",
    headers: {
      "Content-type": "application/json; charset=UTF-8"
    }
  }).then(res => {
    if (res.status === 200) {
      return res.json().then((json) => json.events);
    } else {
      return [];
    }

  });

  // Pass data to the page via props
  return { props: { allUsers, allEvents, allInterests } }
}

interface ServerProps {
  allUsers: User[];
  allEvents: Event[];
  allTags: Interest[];
}

const Home: NextPage = (props: any) => {
  const { user } = useContext(LoginContext);
  const nextprops = {
    userProfile: user,
  };

  console.log(props.allEvents);
  return (
    <div className={styles.container}>
      <Head>
        <title>LetsPlay</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <CustomNavbar props={nextprops} />
      <Spacer y={1.275} />

      <InterestCarousel
        tags={user.tags ? user.tags : []}
        alltags={props.allInterests}
      />
      <Spacer y={1} />
      <ProfileCarousel
        profiles={props.allUsers
          .filter((userProfile: any) => userProfile.email !== user.email)
          .map((userProfile: any) => (
            <ProfileCard info={userProfile} />
          ))}
      />
      <Spacer y={1} />
      <EventCarousel events={props.allEvents.map((event: any) => {
        return <EventCard info={event} />
      })} allTags={props.allTags} />
      <Spacer y={1} />
    </div>
  );
};

export default Home;
